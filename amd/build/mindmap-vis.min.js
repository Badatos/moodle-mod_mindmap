define(["jquery","mod_mindmap/mindmap"],function(a,b){return{Init:function(c,d,e){function f(){document.getElementById("saveButton").onclick=null,document.getElementById("cancelButton").onclick=null,document.getElementById("network-popUp").style.display="none"}function g(a){f(),a(null)}function h(a,b){a.id=document.getElementById("node-id").value,a.label=document.getElementById("node-label").value,a.shape=document.getElementById("node-shape").value,a.font.color=document.getElementById("node-font-color").value,a.color.background=document.getElementById("node-color-background").value,f(),b(a)}function i(a){var b=[];return a.forEach(function(a,c,d){b.push({id:a.id,label:a.label,shape:a.shape,x:a.x,y:a.y,font:{color:a.hasOwnProperty("font")?a.font.color:"#343434"},color:{background:a.hasOwnProperty("color")?a.color.background:"#97c1fc"},widthConstraint:{maximum:180},margin:10})}),new vis.DataSet(b)}function j(a,b){for(var c=0;c<a.length;c++)if(a[c].id==b)return a[c];throw"Can not find id '"+b+"' in data"}function k(a){var b=[];return a.forEach(function(c){c.connections.forEach(function(d,e,f){b.push({from:c.id,to:d,width:2});var g=j(a,d),h=g.connections,i=h.filter(function(a){return a==c.id})[0];i!=-1&&h.splice(i,1)})}),new vis.DataSet(b)}function l(a){return Object.keys(a).map(function(b){return a[b].id=b,a[b]})}function m(a,b){a.connections=s.getConnectedNodes(a.id)}function n(a,b){a.label=s.body.nodes[a.id].options.label,s.body.nodes[a.id].options.hasOwnProperty("shape")&&(a.shape=s.body.nodes[a.id].options.shape),s.body.nodes[a.id].options.font.hasOwnProperty("color")&&(a.font={},a.font.color=s.body.nodes[a.id].options.font.color),s.body.nodes[a.id].options.color.hasOwnProperty("background")&&(a.color={},a.color.background=s.body.nodes[a.id].options.color.background)}function o(){var a=l(s.getPositions());a.forEach(n),a.forEach(m);var d=JSON.stringify(a,void 0,2),e=new b;e.mindmapsubmit(c,d),console.log(d)}var p;a.ajax({async:!1,url:"mindmapdata.php?id="+c+"&convert="+e,success:function(a){p=a}});var q=[{id:"moodle",label:"Moodle",x:400,y:370,font:{color:"#ffffff",size:18},color:{background:"#ff0000"},widthConstraint:{maximum:180},margin:10,borderWidth:1,shape:"ellipse",labelHighlightBold:!1}],r=[],s=null,t=p;if(t.length>0)var u=JSON.parse(t),v={nodes:i(u),edges:k(u)};else var v={nodes:q,edges:r};var w=document.querySelector(".network"),x={};0==d?(x={manipulation:{initiallyActive:!0,addNode:function(a,b){document.getElementById("operation").innerHTML="Add Node",document.getElementById("node-id").value=a.id,document.getElementById("node-label").value="",document.getElementById("node-font-color").value="#343434",document.getElementById("node-color-background").value="#97c1fc",document.getElementById("node-shape").value="ellipse";var c={id:document.getElementById("node-id").value,x:a.x,y:a.y,label:document.getElementById("node-label").value,shape:document.getElementById("node-shape").value,font:{color:document.getElementById("node-font-color").value},color:{background:document.getElementById("node-color-background").value}};document.getElementById("saveButton").onclick=h.bind(this,c,b),document.getElementById("cancelButton").onclick=f.bind(),document.getElementById("network-popUp").style.display="block"},editNode:function(a,b){document.getElementById("operation").innerHTML="Edit Node",document.getElementById("node-id").value=a.id,document.getElementById("node-label").value=a.label,document.getElementById("node-font-color").value=a.font.hasOwnProperty("color")?a.font.color:"#343434",document.getElementById("node-color-background").value=a.color.hasOwnProperty("background")?a.color.background:"#97c1fc",document.getElementById("node-shape").value=a.hasOwnProperty("shape")?a.shape:"ellipse",document.getElementById("saveButton").onclick=h.bind(this,a,b),document.getElementById("cancelButton").onclick=g.bind(this,b),document.getElementById("network-popUp").style.display="block"},addEdge:function(a,b){if(a.from==a.to){var c=confirm("Do you want to connect the node to itself?");1==c&&b(a)}else b(a)}},physics:{enabled:!1},edges:{physics:!1,dashes:!1,smooth:{enabled:!1},width:2},nodes:{borderWidth:1,shape:"ellipse",widthConstraint:{maximum:180},margin:10,font:{size:18},labelHighlightBold:!1}},a("#export_button").on("click",function(){o()})):(x={physics:{enabled:!1},edges:{physics:!1,dashes:!1,smooth:{enabled:!1},width:2},nodes:{borderWidth:1,shape:"ellipse",widthConstraint:{maximum:180},margin:10,font:{size:18},labelHighlightBold:!1}},1==e&&a("#export_button").on("click",function(){o()})),s=new vis.Network(w,v,x),0==d&&s.on("doubleClick",function(a){a.edges.length>=0&&a.nodes.length>0?s.editNode():a.edges.length>0&&0==a.nodes.length?s.editEdgeMode():0==a.edges.length&&0==a.nodes.length&&s.addEdgeMode()})}}});